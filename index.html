<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="css/style.css">
    <style>
        .home h1 {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .button {
            background: black;
            color: white;
            padding: 0.5rem;
            cursor: pointer;
            /* Mostrar siempre en dispositivos móviles */
            display: inline-block;
            margin-top: 20px;
        }

        .home-mod {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            flex-direction: column;
        }

        .home-mod h1 {
            text-align: center;
            font-size: 250%;
            font-family: "Fjalla One", sans-serif;
            font-weight: 400;
        }

        .home-mod h1 a {
            text-decoration: none !important;
            font-family: "Fjalla One", sans-serif;
            color: black;
        }
    </style>
</head>

<body id="tsparticles" class="white">
    <div class="overlay">
        <div class="home-mod">
            <h1><a href="menu_principal.html">ESTACIÓN SENSORIAL <br> CECREA</a></h1>
            <div class="button" id="soundButton">
                Activar sonido
            </div>
        </div>
    </div>

    <!-- Cargar scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"
        integrity="sha512-6+YN/9o9BWrk6wSfGxQGpt3EUK6XeHi6yeHV+TYD2GR0Sj/cggRpXr1BrAQf0as6XslxomMUxXp2vIl+fv0QRA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tsparticles/2.2.2/tsparticles.bundle.min.js"
        integrity="sha512-9q3ZcjB+uNfs+ap06rr6Wquh1beU9O7BIx+Lg1UAUGY9OHrtf9rQxBldFUyPbNSjfkHFZcpu6G34eCIu5HlfvQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/tone"></script>
    
    <!-- Cargar el script principal de sonido después de la configuración -->
    <script>
        // Verificar si estamos en iOS
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
        document.addEventListener("DOMContentLoaded", function () {
            const soundButton = document.getElementById("soundButton");
            
            // En dispositivos que no son iOS, ocultar el botón en escritorio
            if (!isIOS && window.innerWidth > 600) {
                soundButton.style.display = "none";
            }
            
            // Manejar la activación del sonido
            soundButton.addEventListener("click", async function () {
                try {
                    // La clave: Iniciar explícitamente Tone.js dentro del evento de clic
                    if (Tone.context.state !== 'running') {
                        await Tone.start();
                        console.log("AudioContext started through button click");
                        
                        // Necesario para iOS: reproducir un sonido silencioso para "despertar" completamente el audio
                        const silentOsc = new Tone.Oscillator().toDestination();
                        silentOsc.volume.value = -100; // Prácticamente silencioso
                        silentOsc.start();
                        silentOsc.stop("+0.1"); // Detener después de 100ms
                        
                        // Reproducir un breve tono de prueba para confirmar
                        const testOsc = new Tone.Oscillator(440, "sine").toDestination();
                        testOsc.volume.value = -20; // Bajo volumen para no molestar
                        testOsc.start();
                        testOsc.stop("+0.2"); // Detener después de 200ms
                    }
                    
                    // Ocultar el botón una vez que el audio está activado
                    soundButton.style.display = "none";
                    
                } catch (error) {
                    console.error("Error initializing audio:", error);
                    soundButton.textContent = "Intentar nuevamente";
                }
            });
            
            // Intentar iniciar automáticamente en dispositivos que no son iOS
            if (!isIOS) {
                // Los eventos que comúnmente funcionan en navegadores modernos
                ['click', 'touchstart', 'keydown'].forEach(eventType => {
                    document.addEventListener(eventType, async () => {
                        if (Tone.context.state !== 'running') {
                            try {
                                await Tone.start();
                                console.log("AudioContext started automatically");
                                
                                // Ocultar el botón si se inició automáticamente
                                soundButton.style.display = "none";
                            } catch (e) {
                                console.error("Auto initialization failed:", e);
                            }
                        }
                    }, { once: true });
                });
            }
        });
    </script>
    
    <!-- Cargar el script de sonido DESPUÉS de la configuración de audio -->
    <script src="js/presentationSound.js"></script>
    <script src="https://unpkg.com/@barba/core"></script>

    <script>
        // Cargar partículas
        tsParticles
            .loadJSON("tsparticles", "js/particles.json")
            .then((container) => {
                console.log("callback - tsparticles config loaded");
            })
            .catch((error) => {
                console.error(error);
            });
    </script>
</body>

</html>